---
// src/components/ThemeSwitcher.astro
import eventData from '../data/template_demo_rohan_maya.json';

const partnerNames = eventData.coupleNames; 
const tagline = eventData.tagline;

// Robust date formatting to ensure a premium look
const rawDate = new Date(eventData.lastUpdated); 
const eventDate = rawDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<div class="grid lg:grid-cols-2 gap-12 items-center py-12">
  <div class="space-y-6">
    <h2 class="font-heading text-4xl text-stone-900 dark:text-stone-50 leading-tight">
      One Link, <br/>Infinite Expression
    </h2>
    <p class="text-stone-600 dark:text-stone-400 text-lg">
      KokoroLinks adapts to your unique style. Switch themes instantly to see how your event track transforms.
    </p>
    
    <div class="flex flex-wrap gap-3" id="theme-controls">
      <button data-theme="minimalist" class="theme-btn active">Minimalist</button>
      <button data-theme="floral" class="theme-btn">Floral</button>
      <button data-theme="midnight" class="theme-btn">Midnight</button>
    </div>
  </div>

  <div id="preview-card" class="card-joy theme-minimalist transition-all duration-700 min-h-[480px] flex flex-col items-center justify-center p-12 text-center group">
    <div id="theme-icon" class="text-4xl mb-6 transition-all duration-500 opacity-0 scale-50"></div>
    <h4 class="preview-names font-heading text-5xl md:text-6xl mb-6 transition-colors duration-500">
        {partnerNames}
    </h4>
    <div class="w-12 h-[1px] bg-stone-200 mb-6 transition-colors duration-500" id="divider"></div>
    <p class="preview-date uppercase tracking-[0.3em] text-[10px] font-semibold opacity-70">
        {tagline} <span class="mx-2">â€¢</span> {eventDate}
    </p>
  </div>
</div>

<style>
  @reference "../styles/global.css";

.theme-btn {
    @apply px-6 py-2.5 rounded-full border text-sm font-medium transition-all duration-300;
    /* Light Mode */
    @apply border-stone-200 text-stone-600 hover:border-stone-400;
    /* Dark Mode: Increased border and text contrast */
    @apply dark:border-stone-700 dark:text-stone-400 dark:hover:border-stone-500;
  }
  
  /* Active Button: High contrast for both modes */
  .theme-btn.active {
    @apply bg-stone-900 text-white border-stone-900 scale-105 shadow-lg;
    @apply dark:bg-stone-100 dark:text-stone-900 dark:border-stone-100;
  }

  /* Theme: Floral */
  .theme-floral {
    background-color: #fff1f2 !important; /* rose-50 */
    color: #881337 !important; /* rose-900 */
    box-shadow: 0 25px 50px -12px rgba(244, 63, 94, 0.15) !important;
  }
  .theme-floral #divider { @apply bg-rose-200; }
  .theme-floral #theme-icon { @apply opacity-100 scale-100; }

  /* Theme: Midnight */
  .theme-midnight {
    background-color: #1c1917 !important; /* stone-900 */
    color: #fafaf9 !important; /* stone-50 */
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4) !important;
  }
  .theme-midnight #divider { @apply bg-stone-700; }
  .theme-midnight #theme-icon { @apply opacity-100 scale-100 text-amber-400; }

  /* Theme: Minimalist (Default) */
  .theme-minimalist #theme-icon { @apply h-0 mb-0 overflow-hidden opacity-0; }
  
  /* THE FIX: Force Minimalist to remain "Paper-White" */
  /* We use :global(.dark) to target the parent state but force light colors inside */
  :global(.dark) .theme-minimalist.card-joy {
     background-color: #fafaf9 !important; /* stone-50 (off-white) */
     color: #1c1917 !important;            /* stone-900 (dark text) */
     border-color: rgba(0, 0, 0, 0.05) !important;
     box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
  }

  /* Ensure the divider inside the minimalist card also stays dark */
  :global(.dark) .theme-minimalist #divider {
    background-color: #e7e5e4 !important; /* stone-200 */
  }

  /* Ensure the labels like "TOGETHER WITH OUR FAMILIES" remain legible */
  :global(.dark) .theme-minimalist p {
    color: #57534e !important; /* stone-600 */
    opacity: 0.8;
  }
</style>

<script>
  const buttons = document.querySelectorAll('[data-theme]');
  const card = document.getElementById('preview-card');
  const themeIcon = document.getElementById('theme-icon');

  const icons = {
    floral: 'ðŸŒ¸',
    midnight: 'âœ¨',
    minimalist: ''
  };

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const theme = btn.getAttribute('data-theme');
      
      // Update Button UI
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Update Icon
      if (themeIcon) {
        themeIcon.textContent = icons[theme] || '';
      }

      // Update Card Theme classes
      card.className = `card-joy transition-all duration-700 min-h-[480px] flex flex-col items-center justify-center p-12 text-center theme-${theme}`;
    });
  });
</script>